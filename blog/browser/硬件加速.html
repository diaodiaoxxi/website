<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>硬件加速 | 前端小站</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/website/blog/assets/favicon.ico">
    <script type="text/javascript" src="https://cms.hs.net/r/cms/www/itn/js/userAnalysis.js?appkey=NjRfMQ==" async="true" id="user_analysis_id"></script>
    <meta name="description" content="~">
    <link rel="preload" href="/website/blog/assets/css/0.styles.edf1fc31.css" as="style"><link rel="preload" href="/website/blog/assets/js/app.a3a72a23.js" as="script"><link rel="preload" href="/website/blog/assets/js/7.e5a4a7de.js" as="script"><link rel="preload" href="/website/blog/assets/js/62.b56b6e4e.js" as="script"><link rel="preload" href="/website/blog/assets/js/37.133e5c9b.js" as="script"><link rel="prefetch" href="/website/blog/assets/js/1.35396e1f.js"><link rel="prefetch" href="/website/blog/assets/js/10.bcb9a348.js"><link rel="prefetch" href="/website/blog/assets/js/11.026d1919.js"><link rel="prefetch" href="/website/blog/assets/js/12.00d4c28a.js"><link rel="prefetch" href="/website/blog/assets/js/13.4681dd7d.js"><link rel="prefetch" href="/website/blog/assets/js/14.08665e8c.js"><link rel="prefetch" href="/website/blog/assets/js/15.74c3e15f.js"><link rel="prefetch" href="/website/blog/assets/js/16.360f2fb7.js"><link rel="prefetch" href="/website/blog/assets/js/17.fa7d626a.js"><link rel="prefetch" href="/website/blog/assets/js/18.13be786d.js"><link rel="prefetch" href="/website/blog/assets/js/19.23680e51.js"><link rel="prefetch" href="/website/blog/assets/js/2.664274c1.js"><link rel="prefetch" href="/website/blog/assets/js/20.55f3b4e3.js"><link rel="prefetch" href="/website/blog/assets/js/21.8942f4b2.js"><link rel="prefetch" href="/website/blog/assets/js/22.da67ecd7.js"><link rel="prefetch" href="/website/blog/assets/js/23.a89b2b02.js"><link rel="prefetch" href="/website/blog/assets/js/24.723a2bd9.js"><link rel="prefetch" href="/website/blog/assets/js/25.82636da4.js"><link rel="prefetch" href="/website/blog/assets/js/26.af7c40cb.js"><link rel="prefetch" href="/website/blog/assets/js/27.fe4378f8.js"><link rel="prefetch" href="/website/blog/assets/js/28.6f0890d5.js"><link rel="prefetch" href="/website/blog/assets/js/29.6ad4a457.js"><link rel="prefetch" href="/website/blog/assets/js/3.742a7a1e.js"><link rel="prefetch" href="/website/blog/assets/js/30.db2ce232.js"><link rel="prefetch" href="/website/blog/assets/js/31.f991e740.js"><link rel="prefetch" href="/website/blog/assets/js/32.d56dfaeb.js"><link rel="prefetch" href="/website/blog/assets/js/33.93d46f6d.js"><link rel="prefetch" href="/website/blog/assets/js/34.dbe81cd4.js"><link rel="prefetch" href="/website/blog/assets/js/35.7e04ba1f.js"><link rel="prefetch" href="/website/blog/assets/js/36.333b4a68.js"><link rel="prefetch" href="/website/blog/assets/js/38.b648ba2e.js"><link rel="prefetch" href="/website/blog/assets/js/39.bb2de192.js"><link rel="prefetch" href="/website/blog/assets/js/4.cf14bc38.js"><link rel="prefetch" href="/website/blog/assets/js/40.b84b3c27.js"><link rel="prefetch" href="/website/blog/assets/js/41.8382649d.js"><link rel="prefetch" href="/website/blog/assets/js/42.78f45b6f.js"><link rel="prefetch" href="/website/blog/assets/js/43.bc8e996f.js"><link rel="prefetch" href="/website/blog/assets/js/44.32ff1f37.js"><link rel="prefetch" href="/website/blog/assets/js/45.00a4e919.js"><link rel="prefetch" href="/website/blog/assets/js/46.da24a6dc.js"><link rel="prefetch" href="/website/blog/assets/js/47.02039f2b.js"><link rel="prefetch" href="/website/blog/assets/js/48.5f0e9777.js"><link rel="prefetch" href="/website/blog/assets/js/49.2cf784f8.js"><link rel="prefetch" href="/website/blog/assets/js/5.64482bde.js"><link rel="prefetch" href="/website/blog/assets/js/50.fa36e0f8.js"><link rel="prefetch" href="/website/blog/assets/js/51.e2e5684c.js"><link rel="prefetch" href="/website/blog/assets/js/52.a12ef1d5.js"><link rel="prefetch" href="/website/blog/assets/js/53.c582a61e.js"><link rel="prefetch" href="/website/blog/assets/js/54.ac2b27cf.js"><link rel="prefetch" href="/website/blog/assets/js/55.6e071d4d.js"><link rel="prefetch" href="/website/blog/assets/js/56.44fc7909.js"><link rel="prefetch" href="/website/blog/assets/js/57.973853d7.js"><link rel="prefetch" href="/website/blog/assets/js/58.0b14490d.js"><link rel="prefetch" href="/website/blog/assets/js/59.d8341454.js"><link rel="prefetch" href="/website/blog/assets/js/60.082bbb11.js"><link rel="prefetch" href="/website/blog/assets/js/61.b40fb1a3.js"><link rel="prefetch" href="/website/blog/assets/js/63.f43a14f1.js"><link rel="prefetch" href="/website/blog/assets/js/64.c72507b6.js"><link rel="prefetch" href="/website/blog/assets/js/65.f0243d3f.js"><link rel="prefetch" href="/website/blog/assets/js/66.261504f6.js"><link rel="prefetch" href="/website/blog/assets/js/67.61e74772.js"><link rel="prefetch" href="/website/blog/assets/js/68.f7b0033e.js"><link rel="prefetch" href="/website/blog/assets/js/69.603629eb.js"><link rel="prefetch" href="/website/blog/assets/js/70.6c5b77e6.js"><link rel="prefetch" href="/website/blog/assets/js/71.17b1bc7e.js"><link rel="prefetch" href="/website/blog/assets/js/72.34498702.js"><link rel="prefetch" href="/website/blog/assets/js/73.bbc68441.js"><link rel="prefetch" href="/website/blog/assets/js/74.98205159.js"><link rel="prefetch" href="/website/blog/assets/js/75.e371fe5b.js"><link rel="prefetch" href="/website/blog/assets/js/76.e25ba37c.js"><link rel="prefetch" href="/website/blog/assets/js/77.d788a878.js"><link rel="prefetch" href="/website/blog/assets/js/78.a71420c7.js"><link rel="prefetch" href="/website/blog/assets/js/79.ddffbdfc.js"><link rel="prefetch" href="/website/blog/assets/js/8.fc7de73c.js"><link rel="prefetch" href="/website/blog/assets/js/80.cc3773c6.js"><link rel="prefetch" href="/website/blog/assets/js/81.7c76945f.js"><link rel="prefetch" href="/website/blog/assets/js/82.a6809757.js"><link rel="prefetch" href="/website/blog/assets/js/9.4adbc6f5.js">
    <link rel="stylesheet" href="/website/blog/assets/css/0.styles.edf1fc31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/website/blog/" class="home-link router-link-active"><img src="/website/blog/assets/logo.png" alt="前端小站" class="logo"> <span class="site-name can-hide">前端小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/website/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/website/blog/component/api/tree.html" class="nav-link">
  组件
</a></div><div class="nav-item"><a href="/website/blog/javascript/闭包/闭包.html" class="nav-link">
  js
</a></div><div class="nav-item"><a href="/website/blog/vue/mvc&amp;&amp;mvvm.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/website/blog/browser/进程.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/website/blog/network/http.html" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/website/blog/webpack/webpack.html" class="nav-link">
  webpack
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/website/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/website/blog/component/api/tree.html" class="nav-link">
  组件
</a></div><div class="nav-item"><a href="/website/blog/javascript/闭包/闭包.html" class="nav-link">
  js
</a></div><div class="nav-item"><a href="/website/blog/vue/mvc&amp;&amp;mvvm.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/website/blog/browser/进程.html" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/website/blog/network/http.html" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/website/blog/webpack/webpack.html" class="nav-link">
  webpack
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/website/blog/browser/进程.html" class="sidebar-link">进程</a></li><li><a href="/website/blog/browser/浏览器缓存机制.html" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/website/blog/browser/事件流.html" class="sidebar-link">事件流</a></li><li><a href="/website/blog/browser/同源策略.html" class="sidebar-link">同源策略</a></li><li><a href="/website/blog/browser/浏览器url输入的全过程.html" class="sidebar-link">从输入URL到页面展示，这中间发生了什么</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/website/blog/browser/页面优化.html" class="sidebar-link">页面优化</a></li><li><a href="/website/blog/browser/消息队列.html" class="sidebar-link">消息任务队列</a></li><li><a href="/website/blog/browser/硬件加速.html" class="active sidebar-link">硬件加速</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#渲染图层、复合图层" class="sidebar-link">渲染图层、复合图层</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#开启硬件加速" class="sidebar-link">开启硬件加速</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#合成" class="sidebar-link">合成</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#复合图层的作用？（为什么硬件加速会使页面流畅）" class="sidebar-link">复合图层的作用？（为什么硬件加速会使页面流畅）</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#注意点" class="sidebar-link">注意点</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#性能优化点" class="sidebar-link">性能优化点</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#复合图层的使用注意事项" class="sidebar-link">复合图层的使用注意事项</a></li><li class="sidebar-sub-header"><a href="/website/blog/browser/硬件加速.html#如何理解-gpu-硬件加速？" class="sidebar-link">如何理解 GPU 硬件加速？</a></li></ul></li><li><a href="/website/blog/browser/垃圾回收/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/website/blog/browser/preformance.html" class="sidebar-link">Performance</a></li><li><a href="/website/blog/browser/PWA.html" class="sidebar-link">PWA</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="硬件加速"><a href="#硬件加速" class="header-anchor">#</a> 硬件加速</h1> <p><code>一般一个元素开启硬件加速后会变成合成层，可以独立于普通文档流中，改动后可以避免整个页面重绘和回流，提升性能</code></p> <h2 id="渲染图层、复合图层"><a href="#渲染图层、复合图层" class="header-anchor">#</a> 渲染图层、复合图层</h2> <ul><li><p>渲染图层RenderLayer</p> <ul><li>是页面普通的文档流</li> <li>通过绝对定位，相对定位，浮动定位脱离文档流（生成相对应的渲染图层），但它仍然属于默认复合层(根层叠上下文)，共用同一个绘图上下文对象（GraphicsContext）</li></ul></li> <li><p>复合图层GraphicsLayer（图形层、合成层）</p> <ul><li><code>单独分配系统资源</code>,每个复合图层都有一个独立的GraphicsContext</li> <li>当然也会脱离普通文档流，这样一来，不管这个复合图层中怎么变化，也不会影响默认复合层里的回流重绘</li></ul></li> <li><p>只有 GraphicsLayer 是作为纹理(texture)（位图）上传给GPU的。</p></li> <li><p>纹理：可以把它想象成一个从主存储器(例如 RAM)移动到图像存储器(例如 GPU 中的 VRAM)的<code>位图图像</code>(bitmapimage)</p></li></ul> <h2 id="开启硬件加速"><a href="#开启硬件加速" class="header-anchor">#</a> 开启硬件加速</h2> <ul><li>3D转换：translate3d，translateZ依此类推；</li> <li><code>&lt;video&gt;，&lt;canvas&gt;和&lt;iframe&gt;</code>元件;</li> <li>transform和opacity经由Element.animate();</li> <li>transform和opacity经由СSS过渡和动画;</li> <li>有合成层后代同时本身 fixed 定位</li> <li>will-change;</li> <li>拥有加速 CSS 过滤器的元素filter;</li> <li>元素包含一个复合层的兄弟元素(换句话说就是该元素在复合层上面渲染)，而这个兄弟元素的z-index比较小，小于当前元素，那么这个元素（不管是不是应用了硬件加速样式）也会被放到复合层中（注意：容易引起层爆炸）</li> <li>元素有一个包含复合层的后代节点(换句话说，就是一个元素拥有一个子元素，该子元素在自己的层里)</li></ul> <h2 id="合成"><a href="#合成" class="header-anchor">#</a> 合成</h2> <p>合成是一种将页面拆分成不同的 layers，分别将他们<code>栅格化</code>(生成位图)，然后在一个独立的线程——合成器线程里再合成为一个页面。一旦页面滚动，合成器就会将栅格化好的层合成一个新的帧</p> <h2 id="复合图层的作用？（为什么硬件加速会使页面流畅）"><a href="#复合图层的作用？（为什么硬件加速会使页面流畅）" class="header-anchor">#</a> 复合图层的作用？（为什么硬件加速会使页面流畅）</h2> <p>如果你对一个元素应用动画（60fps），主线程需要一帧一帧地渲染，因为动画和 JS 都是在主线程上运行的，如果此时有 JS 占用了过长的时间，就会导致帧渲染不及时，从而动画掉帧。</p> <ul><li>合成层的位图，会交给GPU来合成，比CPU处理的更快，且不容易阻塞主线程的执行</li> <li>CPU与GPU并行行，以同时运行以创建高效的图形管道</li> <li>当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层</li> <li>对于 transform 和 opacity 效果，不会触发 layout 、layer和 paint,直接进入合成线程处理</li></ul> <h2 id="注意点"><a href="#注意点" class="header-anchor">#</a> 注意点</h2> <ul><li><p>提升到合成层后合成层的位图会交GPU处理，但请注意，仅仅只是合成的处理需要用到GPU，生成合成层的位图处理是需要CPU。</p></li> <li><p>当需要 repaint 的时候可以只 repaint 本身，不影响其他层，但是 paint 之前还有 style(样式计算)， layout（布局） 渲染过程，那就意味着即使合成层只是 repaint 了自身，但 style 和 layout 本身就很占用时间。所以要合理控制合层层的层数，不能一味的开启元素的硬件加速，会影响性能</p></li> <li><p>通过transform和opacity创建的复合图层不会引发 layout 和paint，其他的属性暂未确定，因为这两个没有发生形变和rgb变化</p></li></ul> <h2 id="性能优化点"><a href="#性能优化点" class="header-anchor">#</a> 性能优化点</h2> <ul><li>提升动画效果的元素 合成层的好处是<code>不会影响到其他元素的绘制</code>，设置will-change</li> <li>使用 transform 或者 opacity 来实现动画效果， 这样只需要做合成层的合并就好了</li> <li>减少绘制区域 对于不需要重新绘制的区域应尽量避免绘制</li></ul> <h2 id="复合图层的使用注意事项"><a href="#复合图层的使用注意事项" class="header-anchor">#</a> 复合图层的使用注意事项</h2> <ul><li>尽量不要大量使用复合图层，否则由于资源消耗过度，页面反而会变的更卡</li> <li>层爆炸，虽然浏览器有层压缩的机制，但是在使用上也有限制，使用不当，就容易出现层爆炸的问题</li> <li>复合图层会占用系统 RAM 与 GPU(在移动设备上尤其有限)的内存，并且拥有大量的层会因为记录哪些是可见的而引入额外的开销。许多层还会因为过大与许多内容重叠而导致“过度绘制(overdraw)”的情况发生，从而增加栅格化的时间</li></ul> <h2 id="如何理解-gpu-硬件加速？"><a href="#如何理解-gpu-硬件加速？" class="header-anchor">#</a> 如何理解 GPU 硬件加速？</h2> <p>GPU硬件加速：主要是利用GPU提供一些特定的功能，使GPU为CPU来分担一些任务</p> <h3 id="以动画效果为例"><a href="#以动画效果为例" class="header-anchor">#</a> 以动画效果为例</h3> <p>旧软件路径 渲染方式(默认)：</p> <ol><li>如果不在独立的渲染图层，动画效果会造成页面的回流重绘</li> <li>比如设置在了position:absolute;绝对定位下，虽然当前元素脱离了普通文档流，但是元素还是在 <code>默认的复合图层中</code> ，虽然动画不会造成页面的回流重绘，但是还是需要进行 图层绘制，即需要对动画的每一帧（包含其他元素图层的绘制），在进行合成操作，比较耗时</li></ol> <p>硬件加速路径 渲染方式：</p> <ul><li>获取 DOM 并将其分割为多个层</li> <li>将每个层独立的绘制进位图中</li> <li>将层作为纹理上传至 GPU</li> <li>复合多个层来生成最终的屏幕图像</li></ul> <ol><li>会将开启 硬件加速的的元素提升为 复合图层，脱离于普通文档流。</li> <li>将复合图层作为纹理上传至 GPU，并且存储起来，然后之后浏览器只告诉GPU去转换指定的纹理（位图）来实现dom元素的动画更新，其他未改变的复合图层的纹理，可以从缓存中复用，这就叫做<code>GPU合成</code></li></ol> <p>缺点：</p> <ul><li>内存。如果GPU加载了大量的纹理，那么很容易就会发生内容问题，这一点在移动端浏览器上尤为明显，所以，一定要牢记不要让页面的每个元素都使用硬件加速。</li> <li>使用GPU渲染会影响字体的抗锯齿效果。这是因为GPU和CPU具有不同的渲染机制。即使最终硬件加速停止了，文本还是会在动画期间显示得很模糊</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/website/blog/assets/js/app.a3a72a23.js" defer></script><script src="/website/blog/assets/js/7.e5a4a7de.js" defer></script><script src="/website/blog/assets/js/62.b56b6e4e.js" defer></script><script src="/website/blog/assets/js/37.133e5c9b.js" defer></script>
  </body>
</html>
